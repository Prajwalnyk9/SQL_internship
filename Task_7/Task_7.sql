USE LIBRARY_DB;

INSERT INTO AUTHORS (AUTH_ID, NAME) VALUES 
(1, 'J.K. ROWLING'),
(2, 'GEORGE ORWELL'),
(3, 'J.R.R. TOLKIEN'),
(4, 'AGATHA CHRISTIE');

INSERT INTO BOOKS (BOOK_ID, TITLE, PUB_YEAR, GENRE) VALUES 
(101, 'HARRY POTTER AND THE SORCERER''S STONE', 1997, 'FANTASY'),
(102, '1984', 1949, 'DYSTOPIAN'),
(103, 'THE HOBBIT', 1937, 'FANTASY'),
(104, 'MURDER ON THE ORIENT EXPRESS', 1934, 'MYSTERY'),
(105, 'UNKNOWN BOOK', 2000, 'UNKNOWN');

INSERT INTO MEMBERS (MEMBER_ID, NAME, JOIN_DATE) VALUES 
(1, 'ALICE JOHNSON', '2023-01-01'),
(2, 'BOB SMITH', '2023-02-01'),
(3, 'CHARLIE GREEN', '2023-03-15');

INSERT INTO LOANS (LOAN_ID, MEMBER_ID, BOOK_ID, LOAN_DATE, RETURN_DATE) VALUES 
(1001, 1, 101, '2023-06-01', '2023-06-10'),
(1002, 2, 102, '2023-06-05', '2023-06-20'),
(1003, 3, 105, '2023-06-10', '2023-06-25');

INSERT INTO BOOKAUTHORS (BOOK_ID, AUTH_ID) VALUES 
(101, 1),
(102, 2),
(103, 3),
(104, 4),
(105, 2);

CREATE VIEW BookDetailsView AS
SELECT 
    B.BOOK_ID,
    B.TITLE,
    B.GENRE,
    A.NAME AS AUTHOR_NAME
FROM 
    BOOKS B
JOIN BOOKAUTHORS BA ON B.BOOK_ID = BA.BOOK_ID
JOIN AUTHORS A ON BA.AUTH_ID = A.AUTH_ID;

CREATE VIEW LoanHistoryView AS
SELECT 
    L.LOAN_ID,
    M.NAME AS MEMBER_NAME,
    B.TITLE AS BOOK_TITLE,
    L.LOAN_DATE,
    L.RETURN_DATE
FROM 
    LOANS L
JOIN MEMBERS M ON L.MEMBER_ID = M.MEMBER_ID
JOIN BOOKS B ON L.BOOK_ID = B.BOOK_ID;

CREATE VIEW CurrentlyBorrowedBooks AS
SELECT 
    M.NAME AS MEMBER_NAME,
    B.TITLE AS BOOK_TITLE,
    L.LOAN_DATE
FROM 
    LOANS L
JOIN MEMBERS M ON L.MEMBER_ID = M.MEMBER_ID
JOIN BOOKS B ON L.BOOK_ID = B.BOOK_ID
WHERE 
    L.RETURN_DATE IS NULL;

CREATE VIEW GenreSummaryView AS
SELECT 
    GENRE,
    COUNT(*) AS TOTAL_BOOKS
FROM 
    BOOKS
GROUP BY 
    GENRE;

SELECT * FROM BookDetailsView;
SELECT * FROM LoanHistoryView;
SELECT * FROM CurrentlyBorrowedBooks;
SELECT * FROM GenreSummaryView;
